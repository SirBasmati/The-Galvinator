const Discord = require("discord.js");
const client = new Discord.Client();
const fs = require("fs");
const date = new Date();
const snoowrap = require("snoowrap");
const snoostorm = require("snoostorm");
const config = require("./JSON/config/config.json");
const path = require("path");
const directory = path.dirname(require.main.filename);
console.log(directory);
require("dotenv").config();


const JSONFiles = {
    "artwork": directory + "/JSON/artwork.json",
    "brainlet": directory + "/JSON/brainlet.json",
    "copypasta": directory + "/JSON/copypasta.json",
    "discordmeme": directory + "/JSON/discord memes.json",
    "eightball": directory + "/JSON/eightball.json",
    "fino": directory + "/JSON/fino.json",
    "roast": directory + "/JSON/roast.json",
    "userID": directory + "/JSON/users.json"
};


console.log("Loaded all modules");
var addCommand = null;

function JSONManipulation(messageArr) {

    if (messageArr[0] === "add") {
        addCommand = messageArr.shift();
        console.log(addCommand);
        console.log(messageArr);
    }

    let parsedJSON = JSON.parse(fs.readFileSync(JSONFiles[messageArr[0]]));
    let JSONLength = Object.keys(parsedJSON).length;
    
    if (addCommand === null) {
        if (typeof messageArr[1] === "undefined" || parseInt(messageArr[1]) > JSONLength || isNaN(messageArr[1]) === true) { 
            if (parseInt(messageArr[1]) > JSONLength || messageArr !== true) { //overwrites old number and replaces it with a number within the jsons reach, these check to make sure we do that
                messageArr.pop();
            }
            messageArr.push(Math.floor(Math.random() * JSONLength) + 1);
        }
        console.log(messageArr[1]);
        let JSONOutput = parsedJSON[messageArr[1]];
        return JSONOutput;
    }
    else if (addCommand !== null) {
        parsedJSON[JSONLength + 1] = messageArr[1];
        fs.writeFileSync(JSONFiles[messageArr[0]], JSON.stringify(parsedJSON, null, 2));
        return "Link appended to file";
    }
}


    console.log("Logging in")
    client.on("ready", () => {
        console.log(`Logged in as ${client.user.tag}`);
        client.user.setPresence({ game: { name: "fortnite" }, status: "online" });
    });

    client.on("message", msg => {
        msg = msg.content;
        msg = msg.toLowerCase();
        msgSplit = msg.trim().split(/ +/g); //forms array - removes whitespace + splits at spaces
        console.log(msgSplit);
        if (msg.bot !== true) {
            for (let i = 0; i < msgSplit.length; i++) { //message analysis
                if (msgSplit[i] === "im" || msgSplit[i] === "i'm") {
                    let RNG = Math.floor(Math.random() * config.dadChance) + 1;
                    if (RNG === 1) {
                        let dadQuote = msgSplit.splice(i + 1);
                        dadQuote = dadQuote.join(" ");
                        console.log("Hi " + dadQuote + ", I'm dad!");
                    }
                }
                if (msgSplit[i] === "comedy" || msgSplit[i] === "comedgy") {
                    console.log(config.comedy);
                }
            }
        }

        if (msg.startsWith(config.prefix + "add") || msg.startsWith(config.prefix + "discordmeme")) {
            console.log("Adding to database");
            //console.log(JSONManipulation(msg));
        }

        client.login(config.token);
    });
}

catch (err) {
    console.log(err);
}




